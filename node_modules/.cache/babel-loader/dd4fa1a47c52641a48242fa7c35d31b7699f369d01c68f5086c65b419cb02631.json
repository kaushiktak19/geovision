{"ast":null,"code":"/**\n * @module ol/format/GPX\n */\nimport Feature from '../Feature.js';\nimport LineString from '../geom/LineString.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport Point from '../geom/Point.js';\nimport XMLFeature from './XMLFeature.js';\nimport { OBJECT_PROPERTY_NODE_FACTORY, XML_SCHEMA_INSTANCE_URI, createElementNS, isDocument, makeArrayPusher, makeArraySerializer, makeChildAppender, makeObjectPropertySetter, makeSequence, makeSimpleNodeFactory, makeStructureNS, parse, parseNode, pushParseAndPop, pushSerializeAndPop } from '../xml.js';\nimport { get as getProjection } from '../proj.js';\nimport { readDateTime, readDecimal, readPositiveInteger, readString, writeDateTimeTextNode, writeDecimalTextNode, writeNonNegativeIntegerTextNode, writeStringTextNode } from './xsd.js';\nimport { transformGeometryWithOptions } from './Feature.js';\n\n/**\n * @const\n * @type {Array<null|string>}\n */\nconst NAMESPACE_URIS = [null, 'http://www.topografix.com/GPX/1/0', 'http://www.topografix.com/GPX/1/1'];\n\n/**\n * @const\n * @type {string}\n */\nconst SCHEMA_LOCATION = 'http://www.topografix.com/GPX/1/1 ' + 'http://www.topografix.com/GPX/1/1/gpx.xsd';\n\n/**\n * @const\n * @type {Object<string, function(Node, Array<*>): (Feature|undefined)>}\n */\nconst FEATURE_READER = {\n  'rte': readRte,\n  'trk': readTrk,\n  'wpt': readWpt\n};\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst GPX_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'rte': makeArrayPusher(readRte),\n  'trk': makeArrayPusher(readTrk),\n  'wpt': makeArrayPusher(readWpt)\n});\n\n/**\n * @typedef {Object} GPXLink\n * @property {string} [text] text\n * @property {string} [type] type\n */\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst LINK_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'text': makeObjectPropertySetter(readString, 'linkText'),\n  'type': makeObjectPropertySetter(readString, 'linkType')\n});\n\n/**\n * @typedef {Object} GPXAuthor\n * @property {string} [name] name\n * @property {string} [email] email\n * @property {GPXLink} [link] link\n */\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst AUTHOR_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'name': makeObjectPropertySetter(readString),\n  'email': parseEmail,\n  'link': parseLink\n});\n\n/**\n * @typedef {Object} GPXMetadata\n * @property {string} [name] name\n * @property {string} [desc] desc\n * @property {GPXAuthor} [author] author\n * @property {GPXLink} [link] link\n * @property {number} [time] time\n * @property {string} [keywords] keywords\n * @property {Array<number>} [bounds] bounds\n * @property {Object} [extensions] extensions\n *\n */\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst METADATA_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'name': makeObjectPropertySetter(readString),\n  'desc': makeObjectPropertySetter(readString),\n  'author': makeObjectPropertySetter(readAuthor),\n  'copyright': makeObjectPropertySetter(readCopyright),\n  'link': parseLink,\n  'time': makeObjectPropertySetter(readDateTime),\n  'keywords': makeObjectPropertySetter(readString),\n  'bounds': parseBounds,\n  'extensions': parseExtensions\n});\n\n/**\n * @typedef {Object} GPXCopyright\n * @property {string} [author] author\n * @property {number} [year] year\n * @property {string} [license] license\n */\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst COPYRIGHT_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'year': makeObjectPropertySetter(readPositiveInteger),\n  'license': makeObjectPropertySetter(readString)\n});\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\nconst GPX_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'rte': makeChildAppender(writeRte),\n  'trk': makeChildAppender(writeTrk),\n  'wpt': makeChildAppender(writeWpt)\n});\n\n/**\n * @typedef {Object} Options\n * @property {function(Feature, Node):void} [readExtensions] Callback function\n * to process `extensions` nodes. To prevent memory leaks, this callback function must\n * not store any references to the node. Note that the `extensions`\n * node is not allowed in GPX 1.0. Moreover, only `extensions`\n * nodes from `wpt`, `rte` and `trk` can be processed, as those are\n * directly mapped to a feature.\n */\n\n/**\n * @typedef {Object} LayoutOptions\n * @property {boolean} [hasZ] HasZ.\n * @property {boolean} [hasM] HasM.\n */\n\n/**\n * @classdesc\n * Feature format for reading and writing data in the GPX format.\n *\n * Note that {@link module:ol/format/GPX~GPX#readFeature} only reads the first\n * feature of the source.\n *\n * When reading, routes (`<rte>`) are converted into LineString geometries, and\n * tracks (`<trk>`) into MultiLineString. Any properties on route and track\n * waypoints are ignored.\n *\n * When writing, LineString geometries are output as routes (`<rte>`), and\n * MultiLineString as tracks (`<trk>`).\n *\n * @api\n */\nclass GPX extends XMLFeature {\n  /**\n   * @param {Options} [options] Options.\n   */\n  constructor(options) {\n    super();\n    options = options ? options : {};\n\n    /**\n     * @type {import(\"../proj/Projection.js\").default}\n     */\n    this.dataProjection = getProjection('EPSG:4326');\n\n    /**\n     * @type {function(Feature, Node): void|undefined}\n     * @private\n     */\n    this.readExtensions_ = options.readExtensions;\n  }\n\n  /**\n   * @param {Array<Feature>} features List of features.\n   * @private\n   */\n  handleReadExtensions_(features) {\n    if (!features) {\n      features = [];\n    }\n    for (let i = 0, ii = features.length; i < ii; ++i) {\n      const feature = features[i];\n      if (this.readExtensions_) {\n        const extensionsNode = feature.get('extensionsNode_') || null;\n        this.readExtensions_(feature, extensionsNode);\n      }\n      feature.set('extensionsNode_', undefined);\n    }\n  }\n\n  /**\n   * Reads a GPX file's metadata tag, reading among other things:\n   *   - the name and description of this GPX\n   *   - its author\n   *   - the copyright associated with this GPX file\n   *\n   * Will return null if no metadata tag is present (or no valid source is given).\n   *\n   * @param {Document|Element|Object|string} source Source.\n   * @return {GPXMetadata | null} Metadata\n   * @api\n   */\n  readMetadata(source) {\n    if (!source) {\n      return null;\n    }\n    if (typeof source === 'string') {\n      return this.readMetadataFromDocument(parse(source));\n    }\n    if (isDocument(source)) {\n      return this.readMetadataFromDocument( /** @type {Document} */source);\n    }\n    return this.readMetadataFromNode(source);\n  }\n\n  /**\n   * @param {Document} doc Document.\n   * @return {GPXMetadata | null} Metadata\n   */\n  readMetadataFromDocument(doc) {\n    for (let n = /** @type {Node} */doc.firstChild; n; n = n.nextSibling) {\n      if (n.nodeType === Node.ELEMENT_NODE) {\n        const metadata = this.readMetadataFromNode( /** @type {Element} */n);\n        if (metadata) {\n          return metadata;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * @param {Element} node Node.\n   * @return {Object} Metadata\n   */\n  readMetadataFromNode(node) {\n    if (!NAMESPACE_URIS.includes(node.namespaceURI)) {\n      return null;\n    }\n    for (let n = node.firstElementChild; n; n = n.nextElementSibling) {\n      if (NAMESPACE_URIS.includes(n.namespaceURI) && n.localName === 'metadata') {\n        return pushParseAndPop({}, METADATA_PARSERS, n, []);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * @param {Element} node Node.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Options.\n   * @return {import(\"../Feature.js\").default} Feature.\n   */\n  readFeatureFromNode(node, options) {\n    if (!NAMESPACE_URIS.includes(node.namespaceURI)) {\n      return null;\n    }\n    const featureReader = FEATURE_READER[node.localName];\n    if (!featureReader) {\n      return null;\n    }\n    const feature = featureReader(node, [this.getReadOptions(node, options)]);\n    if (!feature) {\n      return null;\n    }\n    this.handleReadExtensions_([feature]);\n    return feature;\n  }\n\n  /**\n   * @param {Element} node Node.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Options.\n   * @return {Array<import(\"../Feature.js\").default>} Features.\n   */\n  readFeaturesFromNode(node, options) {\n    if (!NAMESPACE_URIS.includes(node.namespaceURI)) {\n      return [];\n    }\n    if (node.localName == 'gpx') {\n      /** @type {Array<Feature>} */\n      const features = pushParseAndPop([], GPX_PARSERS, node, [this.getReadOptions(node, options)]);\n      if (features) {\n        this.handleReadExtensions_(features);\n        return features;\n      }\n      return [];\n    }\n    return [];\n  }\n\n  /**\n   * Encode an array of features in the GPX format as an XML node.\n   * LineString geometries are output as routes (`<rte>`), and MultiLineString\n   * as tracks (`<trk>`).\n   *\n   * @param {Array<Feature>} features Features.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Options.\n   * @return {Node} Node.\n   * @api\n   */\n  writeFeaturesNode(features, options) {\n    options = this.adaptOptions(options);\n    //FIXME Serialize metadata\n    const gpx = createElementNS('http://www.topografix.com/GPX/1/1', 'gpx');\n    const xmlnsUri = 'http://www.w3.org/2000/xmlns/';\n    gpx.setAttributeNS(xmlnsUri, 'xmlns:xsi', XML_SCHEMA_INSTANCE_URI);\n    gpx.setAttributeNS(XML_SCHEMA_INSTANCE_URI, 'xsi:schemaLocation', SCHEMA_LOCATION);\n    gpx.setAttribute('version', '1.1');\n    gpx.setAttribute('creator', 'OpenLayers');\n    pushSerializeAndPop( /** @type {import(\"../xml.js\").NodeStackItem} */\n    {\n      node: gpx\n    }, GPX_SERIALIZERS, GPX_NODE_FACTORY, features, [options]);\n    return gpx;\n  }\n}\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst RTE_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'name': makeObjectPropertySetter(readString),\n  'cmt': makeObjectPropertySetter(readString),\n  'desc': makeObjectPropertySetter(readString),\n  'src': makeObjectPropertySetter(readString),\n  'link': parseLink,\n  'number': makeObjectPropertySetter(readPositiveInteger),\n  'extensions': parseExtensions,\n  'type': makeObjectPropertySetter(readString),\n  'rtept': parseRtePt\n});\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst RTEPT_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'ele': makeObjectPropertySetter(readDecimal),\n  'time': makeObjectPropertySetter(readDateTime)\n});\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst TRK_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'name': makeObjectPropertySetter(readString),\n  'cmt': makeObjectPropertySetter(readString),\n  'desc': makeObjectPropertySetter(readString),\n  'src': makeObjectPropertySetter(readString),\n  'link': parseLink,\n  'number': makeObjectPropertySetter(readPositiveInteger),\n  'type': makeObjectPropertySetter(readString),\n  'extensions': parseExtensions,\n  'trkseg': parseTrkSeg\n});\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst TRKSEG_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'trkpt': parseTrkPt\n});\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst TRKPT_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'ele': makeObjectPropertySetter(readDecimal),\n  'time': makeObjectPropertySetter(readDateTime)\n});\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst WPT_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'ele': makeObjectPropertySetter(readDecimal),\n  'time': makeObjectPropertySetter(readDateTime),\n  'magvar': makeObjectPropertySetter(readDecimal),\n  'geoidheight': makeObjectPropertySetter(readDecimal),\n  'name': makeObjectPropertySetter(readString),\n  'cmt': makeObjectPropertySetter(readString),\n  'desc': makeObjectPropertySetter(readString),\n  'src': makeObjectPropertySetter(readString),\n  'link': parseLink,\n  'sym': makeObjectPropertySetter(readString),\n  'type': makeObjectPropertySetter(readString),\n  'fix': makeObjectPropertySetter(readString),\n  'sat': makeObjectPropertySetter(readPositiveInteger),\n  'hdop': makeObjectPropertySetter(readDecimal),\n  'vdop': makeObjectPropertySetter(readDecimal),\n  'pdop': makeObjectPropertySetter(readDecimal),\n  'ageofdgpsdata': makeObjectPropertySetter(readDecimal),\n  'dgpsid': makeObjectPropertySetter(readPositiveInteger),\n  'extensions': parseExtensions\n});\n\n/**\n * @const\n * @type {Array<string>}\n */\nconst LINK_SEQUENCE = ['text', 'type'];\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\nconst LINK_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'text': makeChildAppender(writeStringTextNode),\n  'type': makeChildAppender(writeStringTextNode)\n});\n\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\nconst RTE_SEQUENCE = makeStructureNS(NAMESPACE_URIS, ['name', 'cmt', 'desc', 'src', 'link', 'number', 'type', 'rtept']);\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\nconst RTE_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'name': makeChildAppender(writeStringTextNode),\n  'cmt': makeChildAppender(writeStringTextNode),\n  'desc': makeChildAppender(writeStringTextNode),\n  'src': makeChildAppender(writeStringTextNode),\n  'link': makeChildAppender(writeLink),\n  'number': makeChildAppender(writeNonNegativeIntegerTextNode),\n  'type': makeChildAppender(writeStringTextNode),\n  'rtept': makeArraySerializer(makeChildAppender(writeWptType))\n});\n\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\nconst RTEPT_TYPE_SEQUENCE = makeStructureNS(NAMESPACE_URIS, ['ele', 'time']);\n\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\nconst TRK_SEQUENCE = makeStructureNS(NAMESPACE_URIS, ['name', 'cmt', 'desc', 'src', 'link', 'number', 'type', 'trkseg']);\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\nconst TRK_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'name': makeChildAppender(writeStringTextNode),\n  'cmt': makeChildAppender(writeStringTextNode),\n  'desc': makeChildAppender(writeStringTextNode),\n  'src': makeChildAppender(writeStringTextNode),\n  'link': makeChildAppender(writeLink),\n  'number': makeChildAppender(writeNonNegativeIntegerTextNode),\n  'type': makeChildAppender(writeStringTextNode),\n  'trkseg': makeArraySerializer(makeChildAppender(writeTrkSeg))\n});\n\n/**\n * @const\n * @type {function(*, Array<*>, string=): (Node|undefined)}\n */\nconst TRKSEG_NODE_FACTORY = makeSimpleNodeFactory('trkpt');\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\nconst TRKSEG_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'trkpt': makeChildAppender(writeWptType)\n});\n\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\nconst WPT_TYPE_SEQUENCE = makeStructureNS(NAMESPACE_URIS, ['ele', 'time', 'magvar', 'geoidheight', 'name', 'cmt', 'desc', 'src', 'link', 'sym', 'type', 'fix', 'sat', 'hdop', 'vdop', 'pdop', 'ageofdgpsdata', 'dgpsid']);\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\nconst WPT_TYPE_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'ele': makeChildAppender(writeDecimalTextNode),\n  'time': makeChildAppender(writeDateTimeTextNode),\n  'magvar': makeChildAppender(writeDecimalTextNode),\n  'geoidheight': makeChildAppender(writeDecimalTextNode),\n  'name': makeChildAppender(writeStringTextNode),\n  'cmt': makeChildAppender(writeStringTextNode),\n  'desc': makeChildAppender(writeStringTextNode),\n  'src': makeChildAppender(writeStringTextNode),\n  'link': makeChildAppender(writeLink),\n  'sym': makeChildAppender(writeStringTextNode),\n  'type': makeChildAppender(writeStringTextNode),\n  'fix': makeChildAppender(writeStringTextNode),\n  'sat': makeChildAppender(writeNonNegativeIntegerTextNode),\n  'hdop': makeChildAppender(writeDecimalTextNode),\n  'vdop': makeChildAppender(writeDecimalTextNode),\n  'pdop': makeChildAppender(writeDecimalTextNode),\n  'ageofdgpsdata': makeChildAppender(writeDecimalTextNode),\n  'dgpsid': makeChildAppender(writeNonNegativeIntegerTextNode)\n});\n\n/**\n * @const\n * @type {Object<string, string>}\n */\nconst GEOMETRY_TYPE_TO_NODENAME = {\n  'Point': 'wpt',\n  'LineString': 'rte',\n  'MultiLineString': 'trk'\n};\n\n/**\n * @param {*} value Value.\n * @param {Array<*>} objectStack Object stack.\n * @param {string} [nodeName] Node name.\n * @return {Node|undefined} Node.\n */\nfunction GPX_NODE_FACTORY(value, objectStack, nodeName) {\n  const geometry = /** @type {Feature} */value.getGeometry();\n  if (geometry) {\n    const nodeName = GEOMETRY_TYPE_TO_NODENAME[geometry.getType()];\n    if (nodeName) {\n      const parentNode = objectStack[objectStack.length - 1].node;\n      return createElementNS(parentNode.namespaceURI, nodeName);\n    }\n  }\n}\n\n/**\n * @param {Array<number>} flatCoordinates Flat coordinates.\n * @param {LayoutOptions} layoutOptions Layout options.\n * @param {Element} node Node.\n * @param {!Object} values Values.\n * @return {Array<number>} Flat coordinates.\n */\nfunction appendCoordinate(flatCoordinates, layoutOptions, node, values) {\n  flatCoordinates.push(parseFloat(node.getAttribute('lon')), parseFloat(node.getAttribute('lat')));\n  if ('ele' in values) {\n    flatCoordinates.push( /** @type {number} */values['ele']);\n    delete values['ele'];\n    layoutOptions.hasZ = true;\n  } else {\n    flatCoordinates.push(0);\n  }\n  if ('time' in values) {\n    flatCoordinates.push( /** @type {number} */values['time']);\n    delete values['time'];\n    layoutOptions.hasM = true;\n  } else {\n    flatCoordinates.push(0);\n  }\n  return flatCoordinates;\n}\n\n/**\n * Choose GeometryLayout based on flags in layoutOptions and adjust flatCoordinates\n * and ends arrays by shrinking them accordingly (removing unused zero entries).\n *\n * @param {LayoutOptions} layoutOptions Layout options.\n * @param {Array<number>} flatCoordinates Flat coordinates.\n * @param {Array<number>} [ends] Ends.\n * @return {import(\"../geom/Geometry.js\").GeometryLayout} Layout.\n */\nfunction applyLayoutOptions(layoutOptions, flatCoordinates, ends) {\n  /** @type {import(\"../geom/Geometry.js\").GeometryLayout} */\n  let layout = 'XY';\n  let stride = 2;\n  if (layoutOptions.hasZ && layoutOptions.hasM) {\n    layout = 'XYZM';\n    stride = 4;\n  } else if (layoutOptions.hasZ) {\n    layout = 'XYZ';\n    stride = 3;\n  } else if (layoutOptions.hasM) {\n    layout = 'XYM';\n    stride = 3;\n  }\n  if (stride !== 4) {\n    for (let i = 0, ii = flatCoordinates.length / 4; i < ii; i++) {\n      flatCoordinates[i * stride] = flatCoordinates[i * 4];\n      flatCoordinates[i * stride + 1] = flatCoordinates[i * 4 + 1];\n      if (layoutOptions.hasZ) {\n        flatCoordinates[i * stride + 2] = flatCoordinates[i * 4 + 2];\n      }\n      if (layoutOptions.hasM) {\n        flatCoordinates[i * stride + 2] = flatCoordinates[i * 4 + 3];\n      }\n    }\n    flatCoordinates.length = flatCoordinates.length / 4 * stride;\n    if (ends) {\n      for (let i = 0, ii = ends.length; i < ii; i++) {\n        ends[i] = ends[i] / 4 * stride;\n      }\n    }\n  }\n  return layout;\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<any>} objectStack Object stack.\n * @return {GPXAuthor | undefined} Person object.\n */\nfunction readAuthor(node, objectStack) {\n  const values = pushParseAndPop({}, AUTHOR_PARSERS, node, objectStack);\n  if (values) {\n    return values;\n  }\n  return undefined;\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<any>} objectStack Object stack.\n * @return {GPXCopyright | undefined} Person object.\n */\nfunction readCopyright(node, objectStack) {\n  const values = pushParseAndPop({}, COPYRIGHT_PARSERS, node, objectStack);\n  if (values) {\n    const author = node.getAttribute('author');\n    if (author !== null) {\n      values['author'] = author;\n    }\n    return values;\n  }\n  return undefined;\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction parseBounds(node, objectStack) {\n  const values = /** @type {Object} */objectStack[objectStack.length - 1];\n  const minlat = node.getAttribute('minlat');\n  const minlon = node.getAttribute('minlon');\n  const maxlat = node.getAttribute('maxlat');\n  const maxlon = node.getAttribute('maxlon');\n  if (minlon !== null && minlat !== null && maxlon !== null && maxlat !== null) {\n    values['bounds'] = [[parseFloat(minlon), parseFloat(minlat)], [parseFloat(maxlon), parseFloat(maxlat)]];\n  }\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction parseEmail(node, objectStack) {\n  const values = /** @type {Object} */objectStack[objectStack.length - 1];\n  const id = node.getAttribute('id');\n  const domain = node.getAttribute('domain');\n  if (id !== null && domain !== null) {\n    values['email'] = \"\".concat(id, \"@\").concat(domain);\n  }\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction parseLink(node, objectStack) {\n  const values = /** @type {Object} */objectStack[objectStack.length - 1];\n  const href = node.getAttribute('href');\n  if (href !== null) {\n    values['link'] = href;\n  }\n  parseNode(LINK_PARSERS, node, objectStack);\n}\n\n/**\n * @param {Node} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction parseExtensions(node, objectStack) {\n  const values = /** @type {Object} */objectStack[objectStack.length - 1];\n  values['extensionsNode_'] = node;\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction parseRtePt(node, objectStack) {\n  const values = pushParseAndPop({}, RTEPT_PARSERS, node, objectStack);\n  if (values) {\n    const rteValues = /** @type {!Object} */\n    objectStack[objectStack.length - 1];\n    const flatCoordinates = /** @type {Array<number>} */\n    rteValues['flatCoordinates'];\n    const layoutOptions = /** @type {LayoutOptions} */\n    rteValues['layoutOptions'];\n    appendCoordinate(flatCoordinates, layoutOptions, node, values);\n  }\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction parseTrkPt(node, objectStack) {\n  const values = pushParseAndPop({}, TRKPT_PARSERS, node, objectStack);\n  if (values) {\n    const trkValues = /** @type {!Object} */\n    objectStack[objectStack.length - 1];\n    const flatCoordinates = /** @type {Array<number>} */\n    trkValues['flatCoordinates'];\n    const layoutOptions = /** @type {LayoutOptions} */\n    trkValues['layoutOptions'];\n    appendCoordinate(flatCoordinates, layoutOptions, node, values);\n  }\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction parseTrkSeg(node, objectStack) {\n  const values = /** @type {Object} */objectStack[objectStack.length - 1];\n  parseNode(TRKSEG_PARSERS, node, objectStack);\n  const flatCoordinates = /** @type {Array<number>} */\n  values['flatCoordinates'];\n  const ends = /** @type {Array<number>} */values['ends'];\n  ends.push(flatCoordinates.length);\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {Feature|undefined} Track.\n */\nfunction readRte(node, objectStack) {\n  const options = /** @type {import(\"./Feature.js\").ReadOptions} */\n  objectStack[0];\n  const values = pushParseAndPop({\n    'flatCoordinates': [],\n    'layoutOptions': {}\n  }, RTE_PARSERS, node, objectStack);\n  if (!values) {\n    return undefined;\n  }\n  const flatCoordinates = /** @type {Array<number>} */\n  values['flatCoordinates'];\n  delete values['flatCoordinates'];\n  const layoutOptions = /** @type {LayoutOptions} */values['layoutOptions'];\n  delete values['layoutOptions'];\n  const layout = applyLayoutOptions(layoutOptions, flatCoordinates);\n  const geometry = new LineString(flatCoordinates, layout);\n  transformGeometryWithOptions(geometry, false, options);\n  const feature = new Feature(geometry);\n  feature.setProperties(values, true);\n  return feature;\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {Feature|undefined} Track.\n */\nfunction readTrk(node, objectStack) {\n  const options = /** @type {import(\"./Feature.js\").ReadOptions} */\n  objectStack[0];\n  const values = pushParseAndPop({\n    'flatCoordinates': [],\n    'ends': [],\n    'layoutOptions': {}\n  }, TRK_PARSERS, node, objectStack);\n  if (!values) {\n    return undefined;\n  }\n  const flatCoordinates = /** @type {Array<number>} */\n  values['flatCoordinates'];\n  delete values['flatCoordinates'];\n  const ends = /** @type {Array<number>} */values['ends'];\n  delete values['ends'];\n  const layoutOptions = /** @type {LayoutOptions} */values['layoutOptions'];\n  delete values['layoutOptions'];\n  const layout = applyLayoutOptions(layoutOptions, flatCoordinates, ends);\n  const geometry = new MultiLineString(flatCoordinates, layout, ends);\n  transformGeometryWithOptions(geometry, false, options);\n  const feature = new Feature(geometry);\n  feature.setProperties(values, true);\n  return feature;\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {Feature|undefined} Waypoint.\n */\nfunction readWpt(node, objectStack) {\n  const options = /** @type {import(\"./Feature.js\").ReadOptions} */\n  objectStack[0];\n  const values = pushParseAndPop({}, WPT_PARSERS, node, objectStack);\n  if (!values) {\n    return undefined;\n  }\n  const layoutOptions = /** @type {LayoutOptions} */{};\n  const coordinates = appendCoordinate([], layoutOptions, node, values);\n  const layout = applyLayoutOptions(layoutOptions, coordinates);\n  const geometry = new Point(coordinates, layout);\n  transformGeometryWithOptions(geometry, false, options);\n  const feature = new Feature(geometry);\n  feature.setProperties(values, true);\n  return feature;\n}\n\n/**\n * @param {Element} node Node.\n * @param {string} value Value for the link's `href` attribute.\n * @param {Array<*>} objectStack Node stack.\n */\nfunction writeLink(node, value, objectStack) {\n  node.setAttribute('href', value);\n  const context = objectStack[objectStack.length - 1];\n  const properties = context['properties'];\n  const link = [properties['linkText'], properties['linkType']];\n  pushSerializeAndPop( /** @type {import(\"../xml.js\").NodeStackItem} */{\n    node: node\n  }, LINK_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY, link, objectStack, LINK_SEQUENCE);\n}\n\n/**\n * @param {Element} node Node.\n * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction writeWptType(node, coordinate, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const parentNode = context.node;\n  const namespaceURI = parentNode.namespaceURI;\n  const properties = context['properties'];\n  //FIXME Projection handling\n  node.setAttributeNS(null, 'lat', String(coordinate[1]));\n  node.setAttributeNS(null, 'lon', String(coordinate[0]));\n  const geometryLayout = context['geometryLayout'];\n  switch (geometryLayout) {\n    case 'XYZM':\n      if (coordinate[3] !== 0) {\n        properties['time'] = coordinate[3];\n      }\n    // fall through\n    case 'XYZ':\n      if (coordinate[2] !== 0) {\n        properties['ele'] = coordinate[2];\n      }\n      break;\n    case 'XYM':\n      if (coordinate[2] !== 0) {\n        properties['time'] = coordinate[2];\n      }\n      break;\n    default:\n    // pass\n  }\n  const orderedKeys = node.nodeName == 'rtept' ? RTEPT_TYPE_SEQUENCE[namespaceURI] : WPT_TYPE_SEQUENCE[namespaceURI];\n  const values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop( /** @type {import(\"../xml.js\").NodeStackItem} */\n  {\n    node: node,\n    'properties': properties\n  }, WPT_TYPE_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n}\n\n/**\n * @param {Node} node Node.\n * @param {Feature} feature Feature.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction writeRte(node, feature, objectStack) {\n  const options = /** @type {import(\"./Feature.js\").WriteOptions} */\n  objectStack[0];\n  const properties = feature.getProperties();\n  const context = {\n    node: node\n  };\n  context['properties'] = properties;\n  const geometry = feature.getGeometry();\n  if (geometry.getType() == 'LineString') {\n    const lineString = /** @type {LineString} */\n    transformGeometryWithOptions(geometry, true, options);\n    context['geometryLayout'] = lineString.getLayout();\n    properties['rtept'] = lineString.getCoordinates();\n  }\n  const parentNode = objectStack[objectStack.length - 1].node;\n  const orderedKeys = RTE_SEQUENCE[parentNode.namespaceURI];\n  const values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context, RTE_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n}\n\n/**\n * @param {Element} node Node.\n * @param {Feature} feature Feature.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction writeTrk(node, feature, objectStack) {\n  const options = /** @type {import(\"./Feature.js\").WriteOptions} */\n  objectStack[0];\n  const properties = feature.getProperties();\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  const context = {\n    node: node\n  };\n  context['properties'] = properties;\n  const geometry = feature.getGeometry();\n  if (geometry.getType() == 'MultiLineString') {\n    const multiLineString = /** @type {MultiLineString} */\n    transformGeometryWithOptions(geometry, true, options);\n    properties['trkseg'] = multiLineString.getLineStrings();\n  }\n  const parentNode = objectStack[objectStack.length - 1].node;\n  const orderedKeys = TRK_SEQUENCE[parentNode.namespaceURI];\n  const values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(context, TRK_SERIALIZERS, OBJECT_PROPERTY_NODE_FACTORY, values, objectStack, orderedKeys);\n}\n\n/**\n * @param {Element} node Node.\n * @param {LineString} lineString LineString.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction writeTrkSeg(node, lineString, objectStack) {\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  const context = {\n    node: node\n  };\n  context['geometryLayout'] = lineString.getLayout();\n  context['properties'] = {};\n  pushSerializeAndPop(context, TRKSEG_SERIALIZERS, TRKSEG_NODE_FACTORY, lineString.getCoordinates(), objectStack);\n}\n\n/**\n * @param {Element} node Node.\n * @param {Feature} feature Feature.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction writeWpt(node, feature, objectStack) {\n  const options = /** @type {import(\"./Feature.js\").WriteOptions} */\n  objectStack[0];\n  const context = objectStack[objectStack.length - 1];\n  context['properties'] = feature.getProperties();\n  const geometry = feature.getGeometry();\n  if (geometry.getType() == 'Point') {\n    const point = /** @type {Point} */\n    transformGeometryWithOptions(geometry, true, options);\n    context['geometryLayout'] = point.getLayout();\n    writeWptType(node, point.getCoordinates(), objectStack);\n  }\n}\nexport default GPX;","map":{"version":3,"names":["Feature","LineString","MultiLineString","Point","XMLFeature","OBJECT_PROPERTY_NODE_FACTORY","XML_SCHEMA_INSTANCE_URI","createElementNS","isDocument","makeArrayPusher","makeArraySerializer","makeChildAppender","makeObjectPropertySetter","makeSequence","makeSimpleNodeFactory","makeStructureNS","parse","parseNode","pushParseAndPop","pushSerializeAndPop","get","getProjection","readDateTime","readDecimal","readPositiveInteger","readString","writeDateTimeTextNode","writeDecimalTextNode","writeNonNegativeIntegerTextNode","writeStringTextNode","transformGeometryWithOptions","NAMESPACE_URIS","SCHEMA_LOCATION","FEATURE_READER","readRte","readTrk","readWpt","GPX_PARSERS","LINK_PARSERS","AUTHOR_PARSERS","parseEmail","parseLink","METADATA_PARSERS","readAuthor","readCopyright","parseBounds","parseExtensions","COPYRIGHT_PARSERS","GPX_SERIALIZERS","writeRte","writeTrk","writeWpt","GPX","constructor","options","dataProjection","readExtensions_","readExtensions","handleReadExtensions_","features","i","ii","length","feature","extensionsNode","set","undefined","readMetadata","source","readMetadataFromDocument","readMetadataFromNode","doc","n","firstChild","nextSibling","nodeType","Node","ELEMENT_NODE","metadata","node","includes","namespaceURI","firstElementChild","nextElementSibling","localName","readFeatureFromNode","featureReader","getReadOptions","readFeaturesFromNode","writeFeaturesNode","adaptOptions","gpx","xmlnsUri","setAttributeNS","setAttribute","GPX_NODE_FACTORY","RTE_PARSERS","parseRtePt","RTEPT_PARSERS","TRK_PARSERS","parseTrkSeg","TRKSEG_PARSERS","parseTrkPt","TRKPT_PARSERS","WPT_PARSERS","LINK_SEQUENCE","LINK_SERIALIZERS","RTE_SEQUENCE","RTE_SERIALIZERS","writeLink","writeWptType","RTEPT_TYPE_SEQUENCE","TRK_SEQUENCE","TRK_SERIALIZERS","writeTrkSeg","TRKSEG_NODE_FACTORY","TRKSEG_SERIALIZERS","WPT_TYPE_SEQUENCE","WPT_TYPE_SERIALIZERS","GEOMETRY_TYPE_TO_NODENAME","value","objectStack","nodeName","geometry","getGeometry","getType","parentNode","appendCoordinate","flatCoordinates","layoutOptions","values","push","parseFloat","getAttribute","hasZ","hasM","applyLayoutOptions","ends","layout","stride","author","minlat","minlon","maxlat","maxlon","id","domain","concat","href","rteValues","trkValues","setProperties","coordinates","context","properties","link","coordinate","String","geometryLayout","orderedKeys","getProperties","lineString","getLayout","getCoordinates","multiLineString","getLineStrings","point"],"sources":["C:/Users/Asus/Desktop/population-density-map/node_modules/ol/format/GPX.js"],"sourcesContent":["/**\n * @module ol/format/GPX\n */\nimport Feature from '../Feature.js';\nimport LineString from '../geom/LineString.js';\nimport MultiLineString from '../geom/MultiLineString.js';\nimport Point from '../geom/Point.js';\nimport XMLFeature from './XMLFeature.js';\nimport {\n  OBJECT_PROPERTY_NODE_FACTORY,\n  XML_SCHEMA_INSTANCE_URI,\n  createElementNS,\n  isDocument,\n  makeArrayPusher,\n  makeArraySerializer,\n  makeChildAppender,\n  makeObjectPropertySetter,\n  makeSequence,\n  makeSimpleNodeFactory,\n  makeStructureNS,\n  parse,\n  parseNode,\n  pushParseAndPop,\n  pushSerializeAndPop,\n} from '../xml.js';\nimport {get as getProjection} from '../proj.js';\nimport {\n  readDateTime,\n  readDecimal,\n  readPositiveInteger,\n  readString,\n  writeDateTimeTextNode,\n  writeDecimalTextNode,\n  writeNonNegativeIntegerTextNode,\n  writeStringTextNode,\n} from './xsd.js';\nimport {transformGeometryWithOptions} from './Feature.js';\n\n/**\n * @const\n * @type {Array<null|string>}\n */\nconst NAMESPACE_URIS = [\n  null,\n  'http://www.topografix.com/GPX/1/0',\n  'http://www.topografix.com/GPX/1/1',\n];\n\n/**\n * @const\n * @type {string}\n */\nconst SCHEMA_LOCATION =\n  'http://www.topografix.com/GPX/1/1 ' +\n  'http://www.topografix.com/GPX/1/1/gpx.xsd';\n\n/**\n * @const\n * @type {Object<string, function(Node, Array<*>): (Feature|undefined)>}\n */\nconst FEATURE_READER = {\n  'rte': readRte,\n  'trk': readTrk,\n  'wpt': readWpt,\n};\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst GPX_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'rte': makeArrayPusher(readRte),\n  'trk': makeArrayPusher(readTrk),\n  'wpt': makeArrayPusher(readWpt),\n});\n\n/**\n * @typedef {Object} GPXLink\n * @property {string} [text] text\n * @property {string} [type] type\n */\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst LINK_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'text': makeObjectPropertySetter(readString, 'linkText'),\n  'type': makeObjectPropertySetter(readString, 'linkType'),\n});\n\n/**\n * @typedef {Object} GPXAuthor\n * @property {string} [name] name\n * @property {string} [email] email\n * @property {GPXLink} [link] link\n */\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst AUTHOR_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'name': makeObjectPropertySetter(readString),\n  'email': parseEmail,\n  'link': parseLink,\n});\n\n/**\n * @typedef {Object} GPXMetadata\n * @property {string} [name] name\n * @property {string} [desc] desc\n * @property {GPXAuthor} [author] author\n * @property {GPXLink} [link] link\n * @property {number} [time] time\n * @property {string} [keywords] keywords\n * @property {Array<number>} [bounds] bounds\n * @property {Object} [extensions] extensions\n *\n */\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst METADATA_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'name': makeObjectPropertySetter(readString),\n  'desc': makeObjectPropertySetter(readString),\n  'author': makeObjectPropertySetter(readAuthor),\n  'copyright': makeObjectPropertySetter(readCopyright),\n  'link': parseLink,\n  'time': makeObjectPropertySetter(readDateTime),\n  'keywords': makeObjectPropertySetter(readString),\n  'bounds': parseBounds,\n  'extensions': parseExtensions,\n});\n\n/**\n * @typedef {Object} GPXCopyright\n * @property {string} [author] author\n * @property {number} [year] year\n * @property {string} [license] license\n */\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst COPYRIGHT_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'year': makeObjectPropertySetter(readPositiveInteger),\n  'license': makeObjectPropertySetter(readString),\n});\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\nconst GPX_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'rte': makeChildAppender(writeRte),\n  'trk': makeChildAppender(writeTrk),\n  'wpt': makeChildAppender(writeWpt),\n});\n\n/**\n * @typedef {Object} Options\n * @property {function(Feature, Node):void} [readExtensions] Callback function\n * to process `extensions` nodes. To prevent memory leaks, this callback function must\n * not store any references to the node. Note that the `extensions`\n * node is not allowed in GPX 1.0. Moreover, only `extensions`\n * nodes from `wpt`, `rte` and `trk` can be processed, as those are\n * directly mapped to a feature.\n */\n\n/**\n * @typedef {Object} LayoutOptions\n * @property {boolean} [hasZ] HasZ.\n * @property {boolean} [hasM] HasM.\n */\n\n/**\n * @classdesc\n * Feature format for reading and writing data in the GPX format.\n *\n * Note that {@link module:ol/format/GPX~GPX#readFeature} only reads the first\n * feature of the source.\n *\n * When reading, routes (`<rte>`) are converted into LineString geometries, and\n * tracks (`<trk>`) into MultiLineString. Any properties on route and track\n * waypoints are ignored.\n *\n * When writing, LineString geometries are output as routes (`<rte>`), and\n * MultiLineString as tracks (`<trk>`).\n *\n * @api\n */\nclass GPX extends XMLFeature {\n  /**\n   * @param {Options} [options] Options.\n   */\n  constructor(options) {\n    super();\n\n    options = options ? options : {};\n\n    /**\n     * @type {import(\"../proj/Projection.js\").default}\n     */\n    this.dataProjection = getProjection('EPSG:4326');\n\n    /**\n     * @type {function(Feature, Node): void|undefined}\n     * @private\n     */\n    this.readExtensions_ = options.readExtensions;\n  }\n\n  /**\n   * @param {Array<Feature>} features List of features.\n   * @private\n   */\n  handleReadExtensions_(features) {\n    if (!features) {\n      features = [];\n    }\n    for (let i = 0, ii = features.length; i < ii; ++i) {\n      const feature = features[i];\n      if (this.readExtensions_) {\n        const extensionsNode = feature.get('extensionsNode_') || null;\n        this.readExtensions_(feature, extensionsNode);\n      }\n      feature.set('extensionsNode_', undefined);\n    }\n  }\n\n  /**\n   * Reads a GPX file's metadata tag, reading among other things:\n   *   - the name and description of this GPX\n   *   - its author\n   *   - the copyright associated with this GPX file\n   *\n   * Will return null if no metadata tag is present (or no valid source is given).\n   *\n   * @param {Document|Element|Object|string} source Source.\n   * @return {GPXMetadata | null} Metadata\n   * @api\n   */\n  readMetadata(source) {\n    if (!source) {\n      return null;\n    }\n    if (typeof source === 'string') {\n      return this.readMetadataFromDocument(parse(source));\n    }\n    if (isDocument(source)) {\n      return this.readMetadataFromDocument(/** @type {Document} */ (source));\n    }\n    return this.readMetadataFromNode(source);\n  }\n\n  /**\n   * @param {Document} doc Document.\n   * @return {GPXMetadata | null} Metadata\n   */\n  readMetadataFromDocument(doc) {\n    for (let n = /** @type {Node} */ (doc.firstChild); n; n = n.nextSibling) {\n      if (n.nodeType === Node.ELEMENT_NODE) {\n        const metadata = this.readMetadataFromNode(/** @type {Element} */ (n));\n        if (metadata) {\n          return metadata;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * @param {Element} node Node.\n   * @return {Object} Metadata\n   */\n  readMetadataFromNode(node) {\n    if (!NAMESPACE_URIS.includes(node.namespaceURI)) {\n      return null;\n    }\n    for (let n = node.firstElementChild; n; n = n.nextElementSibling) {\n      if (\n        NAMESPACE_URIS.includes(n.namespaceURI) &&\n        n.localName === 'metadata'\n      ) {\n        return pushParseAndPop({}, METADATA_PARSERS, n, []);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * @param {Element} node Node.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Options.\n   * @return {import(\"../Feature.js\").default} Feature.\n   */\n  readFeatureFromNode(node, options) {\n    if (!NAMESPACE_URIS.includes(node.namespaceURI)) {\n      return null;\n    }\n    const featureReader = FEATURE_READER[node.localName];\n    if (!featureReader) {\n      return null;\n    }\n    const feature = featureReader(node, [this.getReadOptions(node, options)]);\n    if (!feature) {\n      return null;\n    }\n    this.handleReadExtensions_([feature]);\n    return feature;\n  }\n\n  /**\n   * @param {Element} node Node.\n   * @param {import(\"./Feature.js\").ReadOptions} [options] Options.\n   * @return {Array<import(\"../Feature.js\").default>} Features.\n   */\n  readFeaturesFromNode(node, options) {\n    if (!NAMESPACE_URIS.includes(node.namespaceURI)) {\n      return [];\n    }\n    if (node.localName == 'gpx') {\n      /** @type {Array<Feature>} */\n      const features = pushParseAndPop([], GPX_PARSERS, node, [\n        this.getReadOptions(node, options),\n      ]);\n      if (features) {\n        this.handleReadExtensions_(features);\n        return features;\n      }\n      return [];\n    }\n    return [];\n  }\n\n  /**\n   * Encode an array of features in the GPX format as an XML node.\n   * LineString geometries are output as routes (`<rte>`), and MultiLineString\n   * as tracks (`<trk>`).\n   *\n   * @param {Array<Feature>} features Features.\n   * @param {import(\"./Feature.js\").WriteOptions} [options] Options.\n   * @return {Node} Node.\n   * @api\n   */\n  writeFeaturesNode(features, options) {\n    options = this.adaptOptions(options);\n    //FIXME Serialize metadata\n    const gpx = createElementNS('http://www.topografix.com/GPX/1/1', 'gpx');\n    const xmlnsUri = 'http://www.w3.org/2000/xmlns/';\n    gpx.setAttributeNS(xmlnsUri, 'xmlns:xsi', XML_SCHEMA_INSTANCE_URI);\n    gpx.setAttributeNS(\n      XML_SCHEMA_INSTANCE_URI,\n      'xsi:schemaLocation',\n      SCHEMA_LOCATION,\n    );\n    gpx.setAttribute('version', '1.1');\n    gpx.setAttribute('creator', 'OpenLayers');\n\n    pushSerializeAndPop(\n      /** @type {import(\"../xml.js\").NodeStackItem} */\n      ({node: gpx}),\n      GPX_SERIALIZERS,\n      GPX_NODE_FACTORY,\n      features,\n      [options],\n    );\n    return gpx;\n  }\n}\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst RTE_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'name': makeObjectPropertySetter(readString),\n  'cmt': makeObjectPropertySetter(readString),\n  'desc': makeObjectPropertySetter(readString),\n  'src': makeObjectPropertySetter(readString),\n  'link': parseLink,\n  'number': makeObjectPropertySetter(readPositiveInteger),\n  'extensions': parseExtensions,\n  'type': makeObjectPropertySetter(readString),\n  'rtept': parseRtePt,\n});\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst RTEPT_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'ele': makeObjectPropertySetter(readDecimal),\n  'time': makeObjectPropertySetter(readDateTime),\n});\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst TRK_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'name': makeObjectPropertySetter(readString),\n  'cmt': makeObjectPropertySetter(readString),\n  'desc': makeObjectPropertySetter(readString),\n  'src': makeObjectPropertySetter(readString),\n  'link': parseLink,\n  'number': makeObjectPropertySetter(readPositiveInteger),\n  'type': makeObjectPropertySetter(readString),\n  'extensions': parseExtensions,\n  'trkseg': parseTrkSeg,\n});\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst TRKSEG_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'trkpt': parseTrkPt,\n});\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst TRKPT_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'ele': makeObjectPropertySetter(readDecimal),\n  'time': makeObjectPropertySetter(readDateTime),\n});\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Parser>>}\n */\n// @ts-ignore\nconst WPT_PARSERS = makeStructureNS(NAMESPACE_URIS, {\n  'ele': makeObjectPropertySetter(readDecimal),\n  'time': makeObjectPropertySetter(readDateTime),\n  'magvar': makeObjectPropertySetter(readDecimal),\n  'geoidheight': makeObjectPropertySetter(readDecimal),\n  'name': makeObjectPropertySetter(readString),\n  'cmt': makeObjectPropertySetter(readString),\n  'desc': makeObjectPropertySetter(readString),\n  'src': makeObjectPropertySetter(readString),\n  'link': parseLink,\n  'sym': makeObjectPropertySetter(readString),\n  'type': makeObjectPropertySetter(readString),\n  'fix': makeObjectPropertySetter(readString),\n  'sat': makeObjectPropertySetter(readPositiveInteger),\n  'hdop': makeObjectPropertySetter(readDecimal),\n  'vdop': makeObjectPropertySetter(readDecimal),\n  'pdop': makeObjectPropertySetter(readDecimal),\n  'ageofdgpsdata': makeObjectPropertySetter(readDecimal),\n  'dgpsid': makeObjectPropertySetter(readPositiveInteger),\n  'extensions': parseExtensions,\n});\n\n/**\n * @const\n * @type {Array<string>}\n */\nconst LINK_SEQUENCE = ['text', 'type'];\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\nconst LINK_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'text': makeChildAppender(writeStringTextNode),\n  'type': makeChildAppender(writeStringTextNode),\n});\n\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\nconst RTE_SEQUENCE = makeStructureNS(NAMESPACE_URIS, [\n  'name',\n  'cmt',\n  'desc',\n  'src',\n  'link',\n  'number',\n  'type',\n  'rtept',\n]);\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\nconst RTE_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'name': makeChildAppender(writeStringTextNode),\n  'cmt': makeChildAppender(writeStringTextNode),\n  'desc': makeChildAppender(writeStringTextNode),\n  'src': makeChildAppender(writeStringTextNode),\n  'link': makeChildAppender(writeLink),\n  'number': makeChildAppender(writeNonNegativeIntegerTextNode),\n  'type': makeChildAppender(writeStringTextNode),\n  'rtept': makeArraySerializer(makeChildAppender(writeWptType)),\n});\n\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\nconst RTEPT_TYPE_SEQUENCE = makeStructureNS(NAMESPACE_URIS, ['ele', 'time']);\n\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\nconst TRK_SEQUENCE = makeStructureNS(NAMESPACE_URIS, [\n  'name',\n  'cmt',\n  'desc',\n  'src',\n  'link',\n  'number',\n  'type',\n  'trkseg',\n]);\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\nconst TRK_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'name': makeChildAppender(writeStringTextNode),\n  'cmt': makeChildAppender(writeStringTextNode),\n  'desc': makeChildAppender(writeStringTextNode),\n  'src': makeChildAppender(writeStringTextNode),\n  'link': makeChildAppender(writeLink),\n  'number': makeChildAppender(writeNonNegativeIntegerTextNode),\n  'type': makeChildAppender(writeStringTextNode),\n  'trkseg': makeArraySerializer(makeChildAppender(writeTrkSeg)),\n});\n\n/**\n * @const\n * @type {function(*, Array<*>, string=): (Node|undefined)}\n */\nconst TRKSEG_NODE_FACTORY = makeSimpleNodeFactory('trkpt');\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\nconst TRKSEG_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'trkpt': makeChildAppender(writeWptType),\n});\n\n/**\n * @const\n * @type {Object<string, Array<string>>}\n */\n// @ts-ignore\nconst WPT_TYPE_SEQUENCE = makeStructureNS(NAMESPACE_URIS, [\n  'ele',\n  'time',\n  'magvar',\n  'geoidheight',\n  'name',\n  'cmt',\n  'desc',\n  'src',\n  'link',\n  'sym',\n  'type',\n  'fix',\n  'sat',\n  'hdop',\n  'vdop',\n  'pdop',\n  'ageofdgpsdata',\n  'dgpsid',\n]);\n\n/**\n * @const\n * @type {Object<string, Object<string, import(\"../xml.js\").Serializer>>}\n */\n// @ts-ignore\nconst WPT_TYPE_SERIALIZERS = makeStructureNS(NAMESPACE_URIS, {\n  'ele': makeChildAppender(writeDecimalTextNode),\n  'time': makeChildAppender(writeDateTimeTextNode),\n  'magvar': makeChildAppender(writeDecimalTextNode),\n  'geoidheight': makeChildAppender(writeDecimalTextNode),\n  'name': makeChildAppender(writeStringTextNode),\n  'cmt': makeChildAppender(writeStringTextNode),\n  'desc': makeChildAppender(writeStringTextNode),\n  'src': makeChildAppender(writeStringTextNode),\n  'link': makeChildAppender(writeLink),\n  'sym': makeChildAppender(writeStringTextNode),\n  'type': makeChildAppender(writeStringTextNode),\n  'fix': makeChildAppender(writeStringTextNode),\n  'sat': makeChildAppender(writeNonNegativeIntegerTextNode),\n  'hdop': makeChildAppender(writeDecimalTextNode),\n  'vdop': makeChildAppender(writeDecimalTextNode),\n  'pdop': makeChildAppender(writeDecimalTextNode),\n  'ageofdgpsdata': makeChildAppender(writeDecimalTextNode),\n  'dgpsid': makeChildAppender(writeNonNegativeIntegerTextNode),\n});\n\n/**\n * @const\n * @type {Object<string, string>}\n */\nconst GEOMETRY_TYPE_TO_NODENAME = {\n  'Point': 'wpt',\n  'LineString': 'rte',\n  'MultiLineString': 'trk',\n};\n\n/**\n * @param {*} value Value.\n * @param {Array<*>} objectStack Object stack.\n * @param {string} [nodeName] Node name.\n * @return {Node|undefined} Node.\n */\nfunction GPX_NODE_FACTORY(value, objectStack, nodeName) {\n  const geometry = /** @type {Feature} */ (value).getGeometry();\n  if (geometry) {\n    const nodeName = GEOMETRY_TYPE_TO_NODENAME[geometry.getType()];\n    if (nodeName) {\n      const parentNode = objectStack[objectStack.length - 1].node;\n      return createElementNS(parentNode.namespaceURI, nodeName);\n    }\n  }\n}\n\n/**\n * @param {Array<number>} flatCoordinates Flat coordinates.\n * @param {LayoutOptions} layoutOptions Layout options.\n * @param {Element} node Node.\n * @param {!Object} values Values.\n * @return {Array<number>} Flat coordinates.\n */\nfunction appendCoordinate(flatCoordinates, layoutOptions, node, values) {\n  flatCoordinates.push(\n    parseFloat(node.getAttribute('lon')),\n    parseFloat(node.getAttribute('lat')),\n  );\n  if ('ele' in values) {\n    flatCoordinates.push(/** @type {number} */ (values['ele']));\n    delete values['ele'];\n    layoutOptions.hasZ = true;\n  } else {\n    flatCoordinates.push(0);\n  }\n  if ('time' in values) {\n    flatCoordinates.push(/** @type {number} */ (values['time']));\n    delete values['time'];\n    layoutOptions.hasM = true;\n  } else {\n    flatCoordinates.push(0);\n  }\n  return flatCoordinates;\n}\n\n/**\n * Choose GeometryLayout based on flags in layoutOptions and adjust flatCoordinates\n * and ends arrays by shrinking them accordingly (removing unused zero entries).\n *\n * @param {LayoutOptions} layoutOptions Layout options.\n * @param {Array<number>} flatCoordinates Flat coordinates.\n * @param {Array<number>} [ends] Ends.\n * @return {import(\"../geom/Geometry.js\").GeometryLayout} Layout.\n */\nfunction applyLayoutOptions(layoutOptions, flatCoordinates, ends) {\n  /** @type {import(\"../geom/Geometry.js\").GeometryLayout} */\n  let layout = 'XY';\n  let stride = 2;\n  if (layoutOptions.hasZ && layoutOptions.hasM) {\n    layout = 'XYZM';\n    stride = 4;\n  } else if (layoutOptions.hasZ) {\n    layout = 'XYZ';\n    stride = 3;\n  } else if (layoutOptions.hasM) {\n    layout = 'XYM';\n    stride = 3;\n  }\n  if (stride !== 4) {\n    for (let i = 0, ii = flatCoordinates.length / 4; i < ii; i++) {\n      flatCoordinates[i * stride] = flatCoordinates[i * 4];\n      flatCoordinates[i * stride + 1] = flatCoordinates[i * 4 + 1];\n      if (layoutOptions.hasZ) {\n        flatCoordinates[i * stride + 2] = flatCoordinates[i * 4 + 2];\n      }\n      if (layoutOptions.hasM) {\n        flatCoordinates[i * stride + 2] = flatCoordinates[i * 4 + 3];\n      }\n    }\n    flatCoordinates.length = (flatCoordinates.length / 4) * stride;\n    if (ends) {\n      for (let i = 0, ii = ends.length; i < ii; i++) {\n        ends[i] = (ends[i] / 4) * stride;\n      }\n    }\n  }\n  return layout;\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<any>} objectStack Object stack.\n * @return {GPXAuthor | undefined} Person object.\n */\nfunction readAuthor(node, objectStack) {\n  const values = pushParseAndPop({}, AUTHOR_PARSERS, node, objectStack);\n  if (values) {\n    return values;\n  }\n  return undefined;\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<any>} objectStack Object stack.\n * @return {GPXCopyright | undefined} Person object.\n */\nfunction readCopyright(node, objectStack) {\n  const values = pushParseAndPop({}, COPYRIGHT_PARSERS, node, objectStack);\n  if (values) {\n    const author = node.getAttribute('author');\n    if (author !== null) {\n      values['author'] = author;\n    }\n    return values;\n  }\n  return undefined;\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction parseBounds(node, objectStack) {\n  const values = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  const minlat = node.getAttribute('minlat');\n  const minlon = node.getAttribute('minlon');\n  const maxlat = node.getAttribute('maxlat');\n  const maxlon = node.getAttribute('maxlon');\n  if (\n    minlon !== null &&\n    minlat !== null &&\n    maxlon !== null &&\n    maxlat !== null\n  ) {\n    values['bounds'] = [\n      [parseFloat(minlon), parseFloat(minlat)],\n      [parseFloat(maxlon), parseFloat(maxlat)],\n    ];\n  }\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction parseEmail(node, objectStack) {\n  const values = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  const id = node.getAttribute('id');\n  const domain = node.getAttribute('domain');\n  if (id !== null && domain !== null) {\n    values['email'] = `${id}@${domain}`;\n  }\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction parseLink(node, objectStack) {\n  const values = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  const href = node.getAttribute('href');\n  if (href !== null) {\n    values['link'] = href;\n  }\n  parseNode(LINK_PARSERS, node, objectStack);\n}\n\n/**\n * @param {Node} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction parseExtensions(node, objectStack) {\n  const values = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  values['extensionsNode_'] = node;\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction parseRtePt(node, objectStack) {\n  const values = pushParseAndPop({}, RTEPT_PARSERS, node, objectStack);\n  if (values) {\n    const rteValues = /** @type {!Object} */ (\n      objectStack[objectStack.length - 1]\n    );\n    const flatCoordinates = /** @type {Array<number>} */ (\n      rteValues['flatCoordinates']\n    );\n    const layoutOptions = /** @type {LayoutOptions} */ (\n      rteValues['layoutOptions']\n    );\n    appendCoordinate(flatCoordinates, layoutOptions, node, values);\n  }\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction parseTrkPt(node, objectStack) {\n  const values = pushParseAndPop({}, TRKPT_PARSERS, node, objectStack);\n  if (values) {\n    const trkValues = /** @type {!Object} */ (\n      objectStack[objectStack.length - 1]\n    );\n    const flatCoordinates = /** @type {Array<number>} */ (\n      trkValues['flatCoordinates']\n    );\n    const layoutOptions = /** @type {LayoutOptions} */ (\n      trkValues['layoutOptions']\n    );\n    appendCoordinate(flatCoordinates, layoutOptions, node, values);\n  }\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction parseTrkSeg(node, objectStack) {\n  const values = /** @type {Object} */ (objectStack[objectStack.length - 1]);\n  parseNode(TRKSEG_PARSERS, node, objectStack);\n  const flatCoordinates =\n    /** @type {Array<number>} */\n    (values['flatCoordinates']);\n  const ends = /** @type {Array<number>} */ (values['ends']);\n  ends.push(flatCoordinates.length);\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {Feature|undefined} Track.\n */\nfunction readRte(node, objectStack) {\n  const options = /** @type {import(\"./Feature.js\").ReadOptions} */ (\n    objectStack[0]\n  );\n  const values = pushParseAndPop(\n    {\n      'flatCoordinates': [],\n      'layoutOptions': {},\n    },\n    RTE_PARSERS,\n    node,\n    objectStack,\n  );\n  if (!values) {\n    return undefined;\n  }\n  const flatCoordinates =\n    /** @type {Array<number>} */\n    (values['flatCoordinates']);\n  delete values['flatCoordinates'];\n  const layoutOptions = /** @type {LayoutOptions} */ (values['layoutOptions']);\n  delete values['layoutOptions'];\n  const layout = applyLayoutOptions(layoutOptions, flatCoordinates);\n  const geometry = new LineString(flatCoordinates, layout);\n  transformGeometryWithOptions(geometry, false, options);\n  const feature = new Feature(geometry);\n  feature.setProperties(values, true);\n  return feature;\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {Feature|undefined} Track.\n */\nfunction readTrk(node, objectStack) {\n  const options = /** @type {import(\"./Feature.js\").ReadOptions} */ (\n    objectStack[0]\n  );\n  const values = pushParseAndPop(\n    {\n      'flatCoordinates': [],\n      'ends': [],\n      'layoutOptions': {},\n    },\n    TRK_PARSERS,\n    node,\n    objectStack,\n  );\n  if (!values) {\n    return undefined;\n  }\n  const flatCoordinates =\n    /** @type {Array<number>} */\n    (values['flatCoordinates']);\n  delete values['flatCoordinates'];\n  const ends = /** @type {Array<number>} */ (values['ends']);\n  delete values['ends'];\n  const layoutOptions = /** @type {LayoutOptions} */ (values['layoutOptions']);\n  delete values['layoutOptions'];\n  const layout = applyLayoutOptions(layoutOptions, flatCoordinates, ends);\n  const geometry = new MultiLineString(flatCoordinates, layout, ends);\n  transformGeometryWithOptions(geometry, false, options);\n  const feature = new Feature(geometry);\n  feature.setProperties(values, true);\n  return feature;\n}\n\n/**\n * @param {Element} node Node.\n * @param {Array<*>} objectStack Object stack.\n * @return {Feature|undefined} Waypoint.\n */\nfunction readWpt(node, objectStack) {\n  const options = /** @type {import(\"./Feature.js\").ReadOptions} */ (\n    objectStack[0]\n  );\n  const values = pushParseAndPop({}, WPT_PARSERS, node, objectStack);\n  if (!values) {\n    return undefined;\n  }\n  const layoutOptions = /** @type {LayoutOptions} */ ({});\n  const coordinates = appendCoordinate([], layoutOptions, node, values);\n  const layout = applyLayoutOptions(layoutOptions, coordinates);\n  const geometry = new Point(coordinates, layout);\n  transformGeometryWithOptions(geometry, false, options);\n  const feature = new Feature(geometry);\n  feature.setProperties(values, true);\n  return feature;\n}\n\n/**\n * @param {Element} node Node.\n * @param {string} value Value for the link's `href` attribute.\n * @param {Array<*>} objectStack Node stack.\n */\nfunction writeLink(node, value, objectStack) {\n  node.setAttribute('href', value);\n  const context = objectStack[objectStack.length - 1];\n  const properties = context['properties'];\n  const link = [properties['linkText'], properties['linkType']];\n  pushSerializeAndPop(\n    /** @type {import(\"../xml.js\").NodeStackItem} */ ({node: node}),\n    LINK_SERIALIZERS,\n    OBJECT_PROPERTY_NODE_FACTORY,\n    link,\n    objectStack,\n    LINK_SEQUENCE,\n  );\n}\n\n/**\n * @param {Element} node Node.\n * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction writeWptType(node, coordinate, objectStack) {\n  const context = objectStack[objectStack.length - 1];\n  const parentNode = context.node;\n  const namespaceURI = parentNode.namespaceURI;\n  const properties = context['properties'];\n  //FIXME Projection handling\n  node.setAttributeNS(null, 'lat', String(coordinate[1]));\n  node.setAttributeNS(null, 'lon', String(coordinate[0]));\n  const geometryLayout = context['geometryLayout'];\n  switch (geometryLayout) {\n    case 'XYZM':\n      if (coordinate[3] !== 0) {\n        properties['time'] = coordinate[3];\n      }\n    // fall through\n    case 'XYZ':\n      if (coordinate[2] !== 0) {\n        properties['ele'] = coordinate[2];\n      }\n      break;\n    case 'XYM':\n      if (coordinate[2] !== 0) {\n        properties['time'] = coordinate[2];\n      }\n      break;\n    default:\n    // pass\n  }\n  const orderedKeys =\n    node.nodeName == 'rtept'\n      ? RTEPT_TYPE_SEQUENCE[namespaceURI]\n      : WPT_TYPE_SEQUENCE[namespaceURI];\n  const values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(\n    /** @type {import(\"../xml.js\").NodeStackItem} */\n    ({node: node, 'properties': properties}),\n    WPT_TYPE_SERIALIZERS,\n    OBJECT_PROPERTY_NODE_FACTORY,\n    values,\n    objectStack,\n    orderedKeys,\n  );\n}\n\n/**\n * @param {Node} node Node.\n * @param {Feature} feature Feature.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction writeRte(node, feature, objectStack) {\n  const options = /** @type {import(\"./Feature.js\").WriteOptions} */ (\n    objectStack[0]\n  );\n  const properties = feature.getProperties();\n  const context = {node: node};\n  context['properties'] = properties;\n  const geometry = feature.getGeometry();\n  if (geometry.getType() == 'LineString') {\n    const lineString = /** @type {LineString} */ (\n      transformGeometryWithOptions(geometry, true, options)\n    );\n    context['geometryLayout'] = lineString.getLayout();\n    properties['rtept'] = lineString.getCoordinates();\n  }\n  const parentNode = objectStack[objectStack.length - 1].node;\n  const orderedKeys = RTE_SEQUENCE[parentNode.namespaceURI];\n  const values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(\n    context,\n    RTE_SERIALIZERS,\n    OBJECT_PROPERTY_NODE_FACTORY,\n    values,\n    objectStack,\n    orderedKeys,\n  );\n}\n\n/**\n * @param {Element} node Node.\n * @param {Feature} feature Feature.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction writeTrk(node, feature, objectStack) {\n  const options = /** @type {import(\"./Feature.js\").WriteOptions} */ (\n    objectStack[0]\n  );\n  const properties = feature.getProperties();\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  const context = {node: node};\n  context['properties'] = properties;\n  const geometry = feature.getGeometry();\n  if (geometry.getType() == 'MultiLineString') {\n    const multiLineString = /** @type {MultiLineString} */ (\n      transformGeometryWithOptions(geometry, true, options)\n    );\n    properties['trkseg'] = multiLineString.getLineStrings();\n  }\n  const parentNode = objectStack[objectStack.length - 1].node;\n  const orderedKeys = TRK_SEQUENCE[parentNode.namespaceURI];\n  const values = makeSequence(properties, orderedKeys);\n  pushSerializeAndPop(\n    context,\n    TRK_SERIALIZERS,\n    OBJECT_PROPERTY_NODE_FACTORY,\n    values,\n    objectStack,\n    orderedKeys,\n  );\n}\n\n/**\n * @param {Element} node Node.\n * @param {LineString} lineString LineString.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction writeTrkSeg(node, lineString, objectStack) {\n  /** @type {import(\"../xml.js\").NodeStackItem} */\n  const context = {node: node};\n  context['geometryLayout'] = lineString.getLayout();\n  context['properties'] = {};\n  pushSerializeAndPop(\n    context,\n    TRKSEG_SERIALIZERS,\n    TRKSEG_NODE_FACTORY,\n    lineString.getCoordinates(),\n    objectStack,\n  );\n}\n\n/**\n * @param {Element} node Node.\n * @param {Feature} feature Feature.\n * @param {Array<*>} objectStack Object stack.\n */\nfunction writeWpt(node, feature, objectStack) {\n  const options = /** @type {import(\"./Feature.js\").WriteOptions} */ (\n    objectStack[0]\n  );\n  const context = objectStack[objectStack.length - 1];\n  context['properties'] = feature.getProperties();\n  const geometry = feature.getGeometry();\n  if (geometry.getType() == 'Point') {\n    const point = /** @type {Point} */ (\n      transformGeometryWithOptions(geometry, true, options)\n    );\n    context['geometryLayout'] = point.getLayout();\n    writeWptType(node, point.getCoordinates(), objectStack);\n  }\n}\n\nexport default GPX;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}